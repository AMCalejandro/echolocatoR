---
title: "echolocatoR: plotting vignette"
author: "Brian M. Schilder"
date: "Most Recent Update:<br> `r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{plotting_vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
root.dir <- "~/Desktop"
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  root.dir = root.dir
)  
knitr::opts_knit$set(root.dir = root.dir)
# knitr::opts_chunk$get("root.dir")
```

```{r setup, root.dir="~/Desktop"}
library(echolocatoR) 
```

# Plotting only

*echolocatoR* contains various functions that can be used separately  
from the comprehensive `finemap_loci()` pipeline.

Generate a multiview plot using `GGBIO.plot()`.
* You can mix and match different tracks and annotations using the different arguments 
(see `?GGBIO.plot` for details).  
* Zoom in/out by adjusting the `plot.window` size (in units of basepairs).  
The plot is centered on the lead/index SNP.  
* `GGBIO.plot()` returns a `ggbio` track object. 
  + Further modify this object using `ggplot2` functions like `+ theme()`.
  + The modifications will be applied to all tracks at once.  
* Save a high-resolution *.png* of the plot by setting `save_plot=T`  
  + Further increase resolution by adjusting the `dpi` argument (*default=400*).
  + Adjust the `height` and `width` of the saved plot using these respective arguments.
  + The plot will be automatically saved in the locus-specific directory as:  
  *multiview_<locus>_<plot.window>.png*.
   
## Load example data  

Load example dataset of the results from fine-mapping the BST1 locus with `finemap_loci()`.
Original data comes from the recent Nalls et al. (2019) Parkinson's disease GWAS (see `?BST1` for details).

```{r}
library(ggplot2)
data("BST1"); data("LD_matrix"); data("locus_dir");
locus_dir <- file.path("~/Desktop",locus_dir)
finemap_DT <- BST1 
```

## Using NO annotations  

```{r trk_plot}
trk_plot <- GGBIO.plot(finemap_dat=finemap_DT, 
                       LD_matrix=LD_matrix, 
                       locus_dir=locus_dir, 
                       XGR_libnames=NULL, 
                       save_plot=F,
                       show_plot=F)
trk_plot + theme(strip.background = element_rect(fill="gray"),
                 text = element_text(size = 3, color="blue"))
```

## Using only XGR annotations  

Whenever you use annotation arguments (e.g. `XGR_libnames`,`Roadmap`,`Nott_epigenome`)
the annotations that overlap with your locus will automatically be saved as `GRanges` objects  
in a locus-specific subdirectory:  
*results/<dataset_type>/<dataset_name>/<locus>/annotation*  

```{r trk_plot.xgr}
trk_plot.xgr <- GGBIO.plot(finemap_dat=finemap_DT, 
                           LD_matrix=LD_matrix, 
                           locus_dir=locus_dir, 
                           XGR_libnames=c("ENCODE_TFBS_ClusteredV3_CellTypes"), 
                           save_plot=F,
                           show_plot=T)
```

## Using only Roadmap annotations

```{r trk_plot.roadmap} 
trk_plot.roadmap <- GGBIO.plot(finemap_dat=finemap_DT, 
                               LD_matrix=LD_matrix, 
                               locus_dir=locus_dir, 
                               XGR_libnames=NULL, 
                               Roadmap=T, 
                               Roadmap_query="monocyte", 
                               save_plot=F, 
                               show_plot=T)
```


## Using only Nott_2019 annotations

* Query and plot brain cell type-specific epigenomic assays from Nott et al. (2019)  
(see `?NOTT_2019.bigwig_metadata` for details).

```{r trk_plot.nott_2019} 
trk_plot.nott_2019 <- GGBIO.plot(finemap_dat=finemap_DT, 
                                 LD_matrix=LD_matrix, 
                                 locus_dir=locus_dir, 
                                 XGR_libnames=NULL, 
                                 Nott_epigenome=T, 
                                 Nott_binwidth = 100,
                                 Nott_regulatory_rects = T, 
                                 Nott_show_placseq = T,
                                 save_plot=F,
                                 show_plot=T)
```

